<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ToDo List App â€” JS Task Manager</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --muted:#9aa6be; --accent:#5eead4; --accent-2:#7c3aed;
    --success:#10b981; --danger:#ef4444; --glass: rgba(255,255,255,0.03);
    --radius:14px; --gap:12px; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,#071226 0%, #071827 60%); color:#e6eef8;
    display:flex; align-items:center; justify-content:center; padding:28px;
  }

  .app {
    width:100%; max-width:980px; background:linear-gradient(180deg,var(--card), #071226);
    border-radius:18px; padding:22px; box-shadow:0 8px 30px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03);
  }

  header{
    display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:18px;
  }
  .brand {display:flex; gap:12px; align-items:center;}
  .brand .logo{
    width:56px; height:56px; border-radius:12px; background:linear-gradient(135deg,var(--accent-2),var(--accent));
    display:flex; align-items:center; justify-content:center; color:#041026; font-weight:700; font-size:22px;
    box-shadow:0 6px 18px rgba(124,58,237,0.12), inset 0 -6px 12px rgba(0,0,0,0.12);
  }
  h1{margin:0;font-size:20px}
  p.lead{margin:0;color:var(--muted); font-size:13px}

  .controls{
    display:flex; gap:10px; align-items:center;
  }
  .search {
    display:flex; align-items:center; gap:8px; background:var(--glass); padding:8px 10px; border-radius:12px;
    border:1px solid rgba(255,255,255,0.02);
  }
  .search input{
    background:transparent; border:0; outline:0; color:inherit; width:220px;
  }

  .add-panel{
    display:grid; grid-template-columns: 1fr 160px 120px 90px; gap:10px; margin-bottom:14px;
  }
  .field, .btn {
    background:transparent; border-radius:12px; padding:10px; border:1px solid rgba(255,255,255,0.04);
  }
  input[type="text"], input[type="date"], select {
    width:100%; border:0; background:transparent; color:inherit; outline:0; font-size:14px;
  }
  .btn {
    cursor:pointer; display:inline-flex; align-items:center; justify-content:center; gap:8px;
  }
  .btn.primary{
    background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#041026; border:0;
    box-shadow:0 8px 18px rgba(92,234,212,0.08);
  }
  .toolbar{
    display:flex; align-items:center; gap:8px; margin-bottom:12px;
  }
  .filters{display:flex; gap:8px;}
  .chip{
    padding:8px 11px; border-radius:999px; background:transparent; border:1px solid rgba(255,255,255,0.03);
    cursor:pointer; font-size:13px; color:var(--muted);
  }
  .chip.active{ background:rgba(255,255,255,0.03); color:var(--accent); border-color:rgba(124,58,237,0.18)}

  main{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); padding:12px; border-radius:12px;}
  .list{display:grid; gap:8px;}

  .task{
    display:flex; gap:12px; align-items:center; padding:12px; border-radius:12px; background:rgba(0,0,0,0.18);
    border:1px solid rgba(255,255,255,0.02);
  }
  .task.dragging{opacity:0.6; transform:scale(0.995); box-shadow:0 6px 20px rgba(0,0,0,0.4)}
  .check{
    width:20px; height:20px; border-radius:6px; border:2px solid rgba(255,255,255,0.06); display:flex; align-items:center; justify-content:center; cursor:pointer;
  }
  .check.checked{ background:linear-gradient(90deg,var(--accent),var(--accent-2)); border:0; color:#021021}

  .task-body{flex:1; display:flex; flex-direction:column; gap:6px; min-width:0}
  .title-row{display:flex; gap:10px; align-items:center; justify-content:space-between; min-width:0}
  .title{font-size:15px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
  .meta{font-size:12px; color:var(--muted)}
  .actions{display:flex; gap:8px; align-items:center;}
  .icon-btn{background:transparent; border:0; padding:6px; border-radius:8px; cursor:pointer; color:var(--muted)}

  .priority{
    padding:6px 8px; border-radius:8px; font-size:12px; border:1px solid rgba(255,255,255,0.03);
  }
  .priority.low{background:rgba(16,185,129,0.06); color:var(--success)}
  .priority.medium{background:rgba(250,204,21,0.06); color:#f59e0b}
  .priority.high{background:rgba(239,68,68,0.06); color:var(--danger)}

  .empty{padding:36px; text-align:center; color:var(--muted)}

  footer.app-footer{display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:12px; font-size:13px; color:var(--muted)}
  @media (max-width:820px){
    .add-panel{grid-template-columns: 1fr 120px 100px; grid-auto-rows:auto}
    .add-panel .btn.add{grid-column:1/-1}
  }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="ToDo Task Manager">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">TG</div>
        <div>
          <h1>TaskGarden</h1>
          <p class="lead">Web â€¢ Frontend â€¢ Motion Graphics â€” Manage tasks & sprints with style</p>
        </div>
      </div>

      <div class="controls" aria-hidden="false">
        <div class="search" title="Search tasks">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35"/><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6"/></svg>
          <input id="search" type="search" placeholder="Search tasks..." aria-label="Search tasks">
        </div>
      </div>
    </header>

    <section class="add-panel" aria-label="Add new task">
      <div class="field" style="display:flex;align-items:center;">
        <input id="taskTitle" type="text" placeholder="Add a new task (press Enter to add)" aria-label="Task title">
      </div>
      <div class="field">
        <input id="taskDue" type="date" aria-label="Due date">
      </div>
      <div class="field">
        <select id="taskPriority" aria-label="Priority">
          <option value="medium" selected>Priority: Medium</option>
          <option value="high">High</option>
          <option value="medium">Medium</option>
          <option value="low">Low</option>
        </select>
      </div>
      <button id="addBtn" class="btn primary" aria-label="Add task">Add</button>
    </section>

    <div class="toolbar" role="toolbar" aria-label="Task toolbar">
      <div class="filters" role="tablist" aria-label="Filter tasks">
        <button class="chip active" data-filter="all" role="tab" aria-selected="true">All</button>
        <button class="chip" data-filter="active" role="tab" aria-selected="false">Active</button>
        <button class="chip" data-filter="completed" role="tab" aria-selected="false">Completed</button>
      </div>

      <div style="margin-left:auto; display:flex;gap:8px; align-items:center;">
        <button id="sortBtn" class="chip" title="Sort by due date">Sort: Default</button>
        <button id="clearCompleted" class="chip" title="Clear all completed tasks">Clear completed</button>
      </div>
    </div>

    <main>
      <div class="list" id="taskList" aria-live="polite" aria-label="Task list">
        <!-- tasks rendered here -->
      </div>

      <div id="emptyState" class="empty" hidden>
        No tasks yet â€” add your first task and press <strong>Enter</strong>.
      </div>
    </main>

    <footer class="app-footer">
      <div id="counts">0 tasks</div>
      <div>
        <button id="selectAll" class="chip">Select all</button>
        <button id="deleteSelected" class="chip">Delete selected</button>
      </div>
    </footer>
  </div>

<script>
/*
  TaskGarden â€” Vanilla JS ToDo App
  - Tasks stored in localStorage under 'taskgarden.tasks'
  - Drag & drop reordering using HTML5 drag/drop
  - Search, filter, sort, edit, bulk delete, clear completed
*/

const STORAGE_KEY = 'taskgarden.tasks.v1';
let tasks = [];      // array of task objects
let filter = 'all';  // all | active | completed
let sortMode = 'default'; // default | duedate | priority

/* Utility */
const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2,7);
const $ = sel => document.querySelector(sel);
const formatDate = (d) => {
  if(!d) return '';
  const dt = new Date(d);
  if (isNaN(dt)) return d;
  return dt.toLocaleDateString();
};

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
}
function load() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    tasks = raw ? JSON.parse(raw) : [];
  } catch(e) {
    tasks = [];
    console.error('Failed to load tasks', e);
  }
}

/* CRUD */
function addTask({title, due='', priority='medium'}) {
  if (!title || !title.trim()) return null;
  const t = {
    id: uid(),
    title: title.trim(),
    due: due || '',
    priority: priority || 'medium',
    completed: false,
    createdAt: new Date().toISOString()
  };
  tasks.unshift(t); // newest on top by default
  save();
  render();
  return t;
}

function updateTask(id, patch){
  const i = tasks.findIndex(x => x.id === id);
  if (i === -1) return;
  tasks[i] = {...tasks[i], ...patch};
  save();
  render();
}

function deleteTask(id) {
  tasks = tasks.filter(t => t.id !== id);
  save();
  render();
}

function clearCompleted(){
  tasks = tasks.filter(t => !t.completed);
  save();
  render();
}

/* Rendering */
const taskList = $('#taskList');
const emptyState = $('#emptyState');
const countsEl = $('#counts');

function filterAndSortTasks(query='') {
  let out = tasks.slice();
  // filter
  if (filter === 'active') out = out.filter(t => !t.completed);
  if (filter === 'completed') out = out.filter(t => t.completed);
  // search
  if (query) {
    const q = query.toLowerCase();
    out = out.filter(t => t.title.toLowerCase().includes(q) || (t.priority || '').toLowerCase().includes(q));
  }
  // sort
  if (sortMode === 'duedate'){
    out.sort((a,b) => {
      if (!a.due && !b.due) return 0;
      if (!a.due) return 1;
      if (!b.due) return -1;
      return new Date(a.due) - new Date(b.due);
    })
  } else if (sortMode === 'priority'){
    const rank = {high:1, medium:2, low:3};
    out.sort((a,b) => (rank[a.priority]||3) - (rank[b.priority]||3));
  }
  return out;
}

function render() {
  const q = $('#search').value.trim();
  const list = filterAndSortTasks(q);
  taskList.innerHTML = '';
  if (list.length === 0) {
    emptyState.hidden = false;
  } else {
    emptyState.hidden = true;
  }

  list.forEach(task => {
    const item = document.createElement('div');
    item.className = 'task';
    item.draggable = true;
    item.dataset.id = task.id;

    // checkbox
    const chk = document.createElement('button');
    chk.className = 'check' + (task.completed ? ' checked' : '');
    chk.setAttribute('aria-label', task.completed ? 'Mark as not completed' : 'Mark as completed');
    chk.innerHTML = task.completed ? 'âœ“' : '';
    chk.addEventListener('click', () => updateTask(task.id, {completed: !task.completed}));

    // body
    const body = document.createElement('div');
    body.className = 'task-body';

    const titleRow = document.createElement('div');
    titleRow.className = 'title-row';

    const title = document.createElement('div');
    title.className = 'title';
    title.textContent = task.title;
    if (task.completed) title.style.textDecoration = 'line-through';

    const actions = document.createElement('div');
    actions.className = 'actions';

    const due = document.createElement('div');
    due.className = 'meta';
    due.textContent = task.due ? `Due: ${formatDate(task.due)}` : '';

    const pr = document.createElement('div');
    pr.className = 'priority ' + (task.priority || 'medium');
    pr.textContent = (task.priority || 'medium').toUpperCase();

    // edit button
    const editBtn = document.createElement('button');
    editBtn.className = 'icon-btn';
    editBtn.title = 'Edit task';
    editBtn.innerHTML = 'âœŽ';
    editBtn.addEventListener('click', () => beginEdit(item, task));

    // delete
    const delBtn = document.createElement('button');
    delBtn.className = 'icon-btn';
    delBtn.title = 'Delete task';
    delBtn.innerHTML = 'ðŸ—‘';
    delBtn.addEventListener('click', () => {
      if(confirm('Delete this task?')) deleteTask(task.id);
    });

    // checkbox + body + actions appended
    titleRow.appendChild(title);
    actions.appendChild(pr);
    actions.appendChild(editBtn);
    actions.appendChild(delBtn);
    titleRow.appendChild(actions);

    body.appendChild(titleRow);
    if (task.due || task.priority) {
      const metaRow = document.createElement('div');
      metaRow.style.display = 'flex'; metaRow.style.gap = '12px'; metaRow.style.alignItems='center';
      metaRow.appendChild(due);
      body.appendChild(metaRow);
    }

    item.appendChild(chk);
    item.appendChild(body);

    // drag handle - for accessibility show aria-grab
    item.addEventListener('dragstart', (e) => {
      item.classList.add('dragging');
      e.dataTransfer.setData('text/plain', task.id);
      e.dataTransfer.effectAllowed = 'move';
    });
    item.addEventListener('dragend', () => item.classList.remove('dragging'));

    taskList.appendChild(item);
  });

  countsEl.textContent = `${tasks.length} task${tasks.length !== 1 ? 's' : ''} Â· ${tasks.filter(t=>t.completed).length} completed`;
  save();
}

/* Editing */
function beginEdit(itemEl, task) {
  // create an edit UI in-place
  const editId = 'edit-' + task.id;
  if (document.getElementById(editId)) return;
  const body = itemEl.querySelector('.task-body');
  const originalHTML = body.innerHTML;

  const container = document.createElement('div');
  container.id = editId;
  container.style.display = 'grid';
  container.style.gridTemplateColumns = '1fr 130px 100px';
  container.style.gap = '8px';
  container.style.alignItems = 'center';

  const titleInput = document.createElement('input');
  titleInput.type = 'text';
  titleInput.value = task.title;
  titleInput.style.padding = '8px';
  titleInput.style.borderRadius = '8px';
  titleInput.style.border = '1px solid rgba(255,255,255,0.04)';
  titleInput.style.background = 'transparent';
  titleInput.style.color = 'inherit';

  const dueInput = document.createElement('input');
  dueInput.type = 'date';
  dueInput.value = task.due || '';

  const prioritySel = document.createElement('select');
  ['high','medium','low'].forEach(p => {
    const opt = document.createElement('option'); opt.value = p; opt.textContent = p;
    if (p === task.priority) opt.selected = true;
    prioritySel.appendChild(opt);
  });

  const saveBtn = document.createElement('button');
  saveBtn.className = 'btn primary';
  saveBtn.textContent = 'Save';
  saveBtn.addEventListener('click', () => {
    const newTitle = titleInput.value.trim();
    updateTask(task.id, {title: newTitle || task.title, due: dueInput.value || '', priority: prioritySel.value || 'medium'});
  });

  const cancelBtn = document.createElement('button');
  cancelBtn.className = 'btn';
  cancelBtn.textContent = 'Cancel';
  cancelBtn.addEventListener('click', () => {
    body.innerHTML = originalHTML;
    render(); // rebinds interactions
  });

  container.appendChild(titleInput);
  container.appendChild(dueInput);
  container.appendChild(prioritySel);

  body.innerHTML = '';
  body.appendChild(container);

  // Replace actions with save/cancel
  const actionRow = document.createElement('div');
  actionRow.style.display='flex'; actionRow.style.gap='8px'; actionRow.style.marginTop='8px';
  actionRow.appendChild(saveBtn);
  actionRow.appendChild(cancelBtn);
  body.appendChild(actionRow);

  // keyboard shortcuts
  titleInput.focus();
  titleInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') saveBtn.click();
    if (e.key === 'Escape') cancelBtn.click();
  });
}

/* drag & drop sorting handler */
taskList.addEventListener('dragover', (e) => {
  e.preventDefault();
  const dragging = taskList.querySelector('.dragging');
  const afterEl = getDragAfterElement(taskList, e.clientY);
  if (!dragging) return;
  if (afterEl == null) {
    taskList.appendChild(dragging);
  } else {
    taskList.insertBefore(dragging, afterEl);
  }
});

taskList.addEventListener('drop', (e) => {
  e.preventDefault();
  // Build new order from DOM
  const newOrder = Array.from(taskList.children).map(el => el.dataset.id);
  // Reorder tasks array maintaining only the ones in newOrder (filter by view)
  tasks = newOrder.map(id => tasks.find(t => t.id === id)).filter(Boolean);
  save();
  render();
});

function getDragAfterElement(container, y) {
  const draggableElements = [...container.querySelectorAll('.task:not(.dragging)')];
  return draggableElements.reduce((closest, child) => {
    const box = child.getBoundingClientRect();
    const offset = y - box.top - box.height / 2;
    if (offset < 0 && offset > closest.offset) {
      return {offset: offset, element: child};
    } else {
      return closest;
    }
  }, {offset: Number.NEGATIVE_INFINITY}).element;
}

/* UI bindings */
$('#addBtn').addEventListener('click', () => {
  const title = $('#taskTitle').value;
  const due = $('#taskDue').value;
  const priority = $('#taskPriority').value;
  if (!title.trim()) { $('#taskTitle').focus(); return; }
  addTask({title, due, priority});
  $('#taskTitle').value = '';
  $('#taskDue').value = '';
  $('#taskPriority').value = 'medium';
  $('#taskTitle').focus();
});

$('#taskTitle').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    $('#addBtn').click();
  }
});

document.querySelectorAll('.chip').forEach(c => {
  c.addEventListener('click', (ev) => {
    const f = c.dataset.filter;
    if (f) {
      filter = f;
      document.querySelectorAll('.chip').forEach(x => x.classList.remove('active'));
      document.querySelectorAll('.chip[data-filter]').forEach(x => {
        x.classList.toggle('active', x.dataset.filter === filter);
        x.setAttribute('aria-selected', x.dataset.filter === filter ? 'true' : 'false');
      });
      render();
      return;
    }
  });
});

$('#search').addEventListener('input', () => render());

$('#clearCompleted').addEventListener('click', () => {
  if (confirm('Clear all completed tasks?')) {
    clearCompleted();
  }
});

$('#selectAll').addEventListener('click', () => {
  const noneSelected = tasks.every(t => !t._selected);
  tasks.forEach(t => t._selected = noneSelected);
  render();
});

$('#deleteSelected').addEventListener('click', () => {
  const toDelete = tasks.filter(t => t._selected).map(t => t.id);
  if (!toDelete.length) { alert('No tasks selected'); return; }
  if (!confirm(`Delete ${toDelete.length} selected task(s)?`)) return;
  tasks = tasks.filter(t => !toDelete.includes(t.id));
  save(); render();
});

$('#sortBtn').addEventListener('click', () => {
  if (sortMode === 'default') { sortMode = 'duedate'; $('#sortBtn').textContent = 'Sort: Due date'; }
  else if (sortMode === 'duedate') { sortMode = 'priority'; $('#sortBtn').textContent = 'Sort: Priority'; }
  else { sortMode = 'default'; $('#sortBtn').textContent = 'Sort: Default'; }
  render();
});

/* initialize */
load();
render();

/* small enhancement: click on task title toggles selection for bulk actions (ctrl/cmd click for multi) */
taskList.addEventListener('click', (e) => {
  const taskEl = e.target.closest('.task');
  if (!taskEl) return;
  const id = taskEl.dataset.id;
  // clicks on title toggle _selected flag if user hold ctrl/cmd
  if (e.target.classList.contains('title')) {
    const t = tasks.find(x => x.id === id);
    t._selected = !t._selected;
    taskEl.style.outline = t._selected ? '2px solid rgba(94,234,212,0.12)' : '';
    save();
  }
});

/* Accessibility: keyboard shortcuts */
document.addEventListener('keydown', (e) => {
  if (e.key === 'n' && (e.ctrlKey || e.metaKey)) {
    e.preventDefault();
    $('#taskTitle').focus();
  }
});
</script>
</body>
</html>
